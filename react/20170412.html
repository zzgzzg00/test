<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
    </style>
</head>
<body>
<div id="container"></div>
<script src="./common/react.js"></script>
<script src="./common/JSXTransformer.js"></script>
<script type="text/jsx">
    const container=document.querySelector('#container');

    const enableButton=()=>({
        color:'red'
    });

    const disableButton=()=>({
        color:'gray'
    });

    const Input=React.createClass({
        getInitialState(){
            return {value:'test'}
        },
        changeHandle(e){
            this.setState({value:e.target.value});
        },
        render(){
            return <input value={this.state.value} onChange={this.changeHandle.bind(this)}/>
        }
    });

    const Button=React.createClass({
        clickHandle(){
            this.props.add();
        },
        render(){
            return (
                <input type="button" value={this.props.value}
                    onClick={this.clickHandle.bind(this)}
                    style={this.props.style}
                />
            )
        }
    });
    let List=React.createClass({
        getInitialState(){
            return {
                arr:this.props.arr,
                buttonState:enableButton()
            };
        },
        clickHandle(type,e){
            const arr=this.state.arr;
            switch(type){
                case 'add':
                    if(arr.length<5){
                        arr.push(this.input.state.value);
                        this.setState({
                            arr,
                            buttonState:enableButton()
                        });
                    }
                    if(arr.length>=5){
                        this.setState({
                            buttonState:disableButton()
                        });
                    }
                    break;
                case 'remove':
                    if(arr.length>0){
                        arr.pop();
                        this.setState({
                            arr,
                            buttonState:enableButton()
                        });
                    }
                    if(arr.length==0){
                        this.setState({
                            buttonState:disableButton()
                        });
                    }
                    break;
            }

            this.input.setState({value:''});
        },
        render(){
            const arr=this.state.arr.map(item=><Item item={item} />);
            return (
                <div>
                    {arr}
                    <Input ref={input=>this.input=input} />
                    <Button add={this.clickHandle.bind(this,'add')}
                        style={this.state.buttonState}
                        value="add"
                    />
                    <Button add={this.clickHandle.bind(this,'remove')}
                        style={this.state.buttonState}
                        value="remove"
                    />
                </div>
            )
        }
    });

    const Item=React.createClass({
        render(){
            return <p>{this.props.item}</p>
        }
    })

    function addData(Component,data){
        return React.createClass({
            getInitialState(){
                return {data:data}
            },
            componentWillMount(){
                const me=this;
                Promise.resolve().then(function(){
                    const arr=me.state.data;
                    arr.length=0;
                    arr.push(...['test1','test2']);
                    me.setState({data:arr})
                });
            },
            render(){
                return <Component arr={this.state.data} />
            }
        })
    }

    List=addData(List,[1,2,3,4]);
    React.render(<List />,container);
</script>
</body>
</html>