<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        *{
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        .progress{
            height: 20px;
        }
    </style>
</head>
<body>
<div id="container"></div>
<script src="./common/JSXTransformer.js"></script>
<script src="./common/react15.js"></script>
<script src="./common/react-dom15.js"></script>
<script type="text/jsx">
    const {Component}=React;

    const defaultSettings={
        preSaleColor:'#808080',//预售颜色
        sepColor:'rgba(0,0,0,0)',//空白颜色
        sepLenArr:[10,15,25,40],//每档所占屏幕比例
        hasSaledColor:['red','yellow','blue','green'],//已售每档颜色
        sepNumArr:[10,25,50,100],//每档最低票数
        backcolor:'black'
    }

    function createLinearGradient(linesArr,obj,backcolor){
        const {sepColor,sepLen}=obj;
        const arr=['linear-gradient(90deg'],lineLen=linesArr.length-1;
        let now=0,len=obj.sepLenArr.length;
        linesArr.forEach(function(item,index){
            arr.push(item.color + ' ' + 0);
            now+=item.len;
            arr.push(item.color + ' ' + now + '%');
            arr.push(item.color + ' ' + 0);
            arr.push(sepColor + ' ' + 0);
            if(index != lineLen){
                now+=sepLen;
                arr.push(sepColor + ' ' + now + '%');
            }
        });
        return arr.join(',')+(backcolor?','+backcolor+' '+now+'%':'')+')'
    }

    //获取所在档位及所在档位的百分比
    function getSep(num,obj){
        const {sepNumArr}=obj;
        for(let i=0,len=sepNumArr.length;i<len;i++){
            if(num<=sepNumArr[i]){
                const preSep=~~sepNumArr[i-1];
                return {
                    sep:i,
                    per:(num-preSep)/(sepNumArr[i]-preSep)
                }
            }
        }
    }

    //设置屏幕显示
    function getLinearSpread(num,obj,isPreSale){
        const arr=[];
        const {preSaleColor,sepLenArr,hasSaledColor}=obj;
        const sep=getSep(num,obj);
        for(let i=0;i<sep.sep;i++){
            arr.push({
                color:isPreSale?preSaleColor:hasSaledColor[i],
                len:sepLenArr[i]
            });
        }
        arr.push({
            color:isPreSale?preSaleColor:hasSaledColor[sep.sep],
            len:sepLenArr[sep.sep]*sep.per
        });
        return arr;
    }

    const createProgress=function(obj=defaultSettings){
        if(obj != defaultSettings){
            obj=Object.assign({},defaultSettings,obj)
        }
        const sepLen=(100 - obj.sepLenArr.reduce((a,b)=>a+b))/(obj.sepLenArr.length-1);
        obj.sepLen=sepLen;
        return props=>{
            const {hasSaledNum,preSaleNum}=props;
            const hasSaledColor=createLinearGradient(getLinearSpread(hasSaledNum,obj),obj);
            const preSaleColor=createLinearGradient(getLinearSpread(preSaleNum,obj,true),obj,obj.backcolor);
            return (<div
                        className={'progress'}
                        style={{background:hasSaledColor+','+preSaleColor}}
                    ></div>)
                  }
    }
    const Progress=createProgress();
    ReactDOM.render(<Progress
                        hasSaledNum={35}
                        preSaleNum={50}
                    />,document.querySelector('#container'));
</script>
</body>
</html>