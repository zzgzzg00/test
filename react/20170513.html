<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<script src="./common/react15.js"></script>
<script src="./common/JSXTransformer.js"></script>
<script src="./common/redux.js"></script>
<script src="./common/react-redux.js"></script>
<script src="./common/react-dom15.js"></script>
<script type="text/jsx">
{
    const {Component,PropTypes}=React;
    const {combineReducers,createStore}=Redux;
    const {Provider,connect}=ReactRedux;

    const initState={
        selectedValue:'tab1'
    }

    const selectedReducer=function(selectedValue='tab1',action){
        const {type,value}=action;
        switch(type){
            case 'change':
                return value;
            default:
                return selectedValue
        }
    }

    const reducer=combineReducers({
        selectedValue:selectedReducer
    });

    const selectedActionCreator=function(value){
        return {
            type:'change',
            value
        }
    }

    const store=createStore(reducer,initState);
    //store.subscribe(()=>console.log(store.getState()));
    //store.dispatch(selectedActionCreator('aa'));

    class Select extends Component{
        constructor(props){
            super(props);
        }
        static get propTypes(){
            return{
                selectedValue:PropTypes.string.isRequired,
                changeHandle:PropTypes.func.isRequired,
                options:PropTypes.array.isRequired
            }
        }
        static get defaultProps(){
            return {
                options:[].map(item=>`tab${item}`)
            }
        }
        render(){
            const options=this.props.options.map(item=>(<option value={item}>{item}</option>));
            return(
                <select onChange={this.props.changeHandle} value={this.props.selectedValue}>
                    {options}
                </select>
            )
        }
    }

    const selectStateMapToProps=function(state){
        const {selectedValue,options}=state;
        return{
            selectedValue
        }
    }
    const selectDispatchMapToProps=function(dispatch){
        return{
            changeHandle(e){
                dispatch(selectedActionCreator(e.target.value));
            }
        }
    }

    const SelectContainer=connect(selectStateMapToProps,selectDispatchMapToProps)(Select);

    class Context extends Component{
        constructor(props){
            console.log(props);
            super(props);
        }
        static get propTypes(){
            return {
                color:PropTypes.string.isRequired,
                context:PropTypes.string.isRequired,
                index:PropTypes.string.isRequired
            }
        }
        static get defaultProps(){
            return{
                color:'red',
                context:'context',
                index:'tab1'
            }
        }
        render(){
            const display=this.props.index===this.props.selectedValue?'block':'none';
            const {color,context}=this.props;
            return(
                <div style={{color,display}}>
                    {context}
                </div>
            )
        }
    }

    const contextStateMapToProps=function(state){
        return {
            selectedValue:state.selectedValue
        }
    }

    const ContextContainer=connect(contextStateMapToProps)(Context);

    class App extends Component{
        render(){
            return (
                <Provider store={store}>
                    <div>
                        <SelectContainer
                            options={[1,2,3].map(item=>`tab${item}`)}
                        />
                        <ContextContainer
                            color='red'
                            context='tab1'
                            index='tab1'
                        />
                        <ContextContainer
                            color='yellow'
                            context='tab2'
                            index='tab2'
                        />
                        <ContextContainer
                            color='green'
                            context='tab3'
                            index='tab3'
                        />
                    </div>
                </Provider>
            )
        }
    }

    ReactDOM.render(<App />,document.body);
}
</script>
</body>
</html>