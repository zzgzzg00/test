<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<script src="./common/react15.js"></script>
<script src="./common/react-dom15.js"></script>
<script src="./common/JSXTransformer.js"></script>
<script src="./common/redux.js"></script>
<script src="./common/react-redux.js"></script>
<script type="text/jsx">
{
    const {Component,PropTypes}=React;
    const {createStore,combineReducers}=Redux;
    const {connect,Provider}=ReactRedux;
    const defaultState={
        title:'title',
        titleColor:'yellow',
        lists:[1,2,3].map(item=>`item-${item}`),
        listsColor:'red'
    };
    function titleReducer(state='',action){
        const {type,title}=action;
        switch(type){
            case 'rename':
                return title;
            default:
                return state;
        }
    }
    function listsReducer(state=[],action){
        switch(action.type){
            case 'add':
                return state.concat([action.item]);
            case 'delete':
                return state.filter((item,index)=>index!=action.index);
            default:
                return state;
        }
    }
    const reducer=combineReducers({
        title:titleReducer,
        lists:listsReducer
    });
    const store=createStore(reducer,defaultState);
    function renameCreater(title){
        return {type:'rename',title};
    }
    function addCreater(item){
        return {type:'add',item};
    }
    function deleteCreater(index){
        return {type:'delete',index}
    }
    //store.dispatch(renameCreater('test'));

    class Lists extends Component{
        constructor(props){
            super(props);
        }
        static get propTypes(){
            return {
                lists:PropTypes.array.isRequired,
                clickHandle:PropTypes.func.isRequired
            }
        }
        render(){
            const items=this.props.lists.map(item=>(<li>{item}</li>));
            return(
                <ul onClick={this.props.clickHandle} style={{color:this.props.color}}>
                    {items}
                </ul>
            )
        }
    }
    //用以获取对应组件的state
    function listsStateToProps(state){
        return {
            lists:state.lists,
            color:state.listsColor
        }
    }
    //修改state
    function listsDispatchToProps(dispatch){
        let i=3;
        return {
            clickHandle(){
                dispatch(addCreater(`item-${++i}`))
            }
        }
    }
    const ListsContainer=connect(listsStateToProps,listsDispatchToProps)(Lists);

    class Title extends Component{
        constructor(props){
            super(props);
        }
        static get propTypes(){
            return {
                title:PropTypes.string.isRequired,
                clickHandle:PropTypes.func.isRequired
            }
        }
        render(){
            return(
                <h1 style={{color:this.props.color}} onClick={this.props.clickHandle}>{this.props.title}</h1>
            )
        }
    }

    function titleStateToProps(state){
        return {
            title:state.title,
            color:state.titleColor
        }
    }
    function titleDispatchToProps(dispatch){
        let i=0;
        return {
            clickHandle(){
                dispatch(renameCreater(`title-${++i}`))
            }
        }
    }

    const TitleContainer=connect(titleStateToProps,titleDispatchToProps)(Title);
    class App extends Component{
        render(){
            return(
                <Provider store={store}>
                    <div>
                        <TitleContainer />
                        <ListsContainer />
                    </div>
                </Provider>
            )
        }
    }
    ReactDOM.render(<App />,document.body);
}
</script>
</body>
</html>