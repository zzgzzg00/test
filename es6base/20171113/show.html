<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        *{
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        div:nth-of-type(1){
            height: 100vh;
            background-color: red;
        }
        div:nth-of-type(2){
            height: 30vh;
            background-color: #ffff00;
        }
        div:nth-of-type(3){
            height: 120vh;
            background-color: green;
        }
    </style>
</head>
<body>
<div></div>
<div></div>
<div></div>
<script>
    var windowHeight;
    function getWindowHeight(){
        return windowHeight || (windowHeight=window.innerHeight
                || document.documentElement && document.documentElement.clientHeight
                || document.body.clientHeight);
    }
    function checkIsInView(o){
        var isOutView=o.top<0 && o.bottom<=0 || o.top>=getWindowHeight();
        return !isOutView;
    }
    function _observeElement(doms,options){
        var client,hasShown,whenShowTime;
        doms.forEach(function(item,index){
            client=item.getBoundingClientRect();
            if(checkIsInView(client)){
                hasShown=item.getAttribute(options.sign);
                if(!hasShown){
                    item.setAttribute(options.sign,+new Date());
                    options.changeshowcallback(item,index);
                }
                options.whenshowcallback(item,index);
            }else{
                whenShowTime=item.getAttribute(options.sign);
                if(whenShowTime){
                    options.callback(item,index,new Date() - whenShowTime);
                    item.removeAttribute(options.sign);
                    options.changehidecallback(item,index);
                }
                options.whenhidecallback(item,index);
            }
        });
    }
    function observeElement(doms,options){
        var handle=null;
        var emptyfunction = Function.prototype;
        options.sign = options.sign || 'data-show-time';
        options.whenshowcallback = options.whenshowcallback || emptyfunction;
        options.whenhidecallback = options.whenhidecallback || emptyfunction;
        options.callback = options.callback || emptyfunction;
        options.changeshowcallback = options.changeshowcallback || emptyfunction;
        options.changehidecallback = options.changehidecallback || emptyfunction;
        _observeElement(doms,options);
        window.onscroll=function(){
            if(handle){
                window.clearTimeout(handle);
                handle=null;
            }
            handle=window.setTimeout(function(){
                _observeElement(doms,options);
            },40);
        }
    }
    function xx(){
        var x=[].slice.call(arguments);
        alert(x.join('|'));
    }
    var options={
        callback:xx
//        whenshowcallback:console.log.bind(null,'whenshowcallback'),
//        whenhidecallback:console.log.bind(null,'whenhidecallback'),
//        changeshowcallback:console.log.bind(null,'changeshowcallback'),
//        changehidecallback:console.log.bind(null,'changehidecallback')
    }
    observeElement([].slice.call(document.querySelectorAll('div')),options);
</script>
</body>
</html>