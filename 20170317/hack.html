<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta content="telephone=no" name="format-detection" />
    <meta name="apple-mobile-web-app-title" content="汽车票-qunar.com">
    <meta name="full-screen" content="yes"/>
    <meta name="browsermode" content="application"/>
    <meta name="x5-orientation" content="portrait"/>
    <meta name="x5-fullscreen" content="true"/>
    <meta name="x5-page-mode" content="app"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui" />
    <meta name="keywords" content="火车票,火车票查询,列车时刻表,火车票预定" />
    <meta name="description" content="去哪儿网(Qunar.com)火车票频道提供全国列车时刻表查询、火车票查询、火车票车次查询、火车票站站查询、高铁列车时刻表及价格查询。" />
    <style>
        *{
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            line-height: 1.5;
            text-decoration: none;
        }
        .invaild{
            box-shadow: 0 0 5px red inset;
        }
        :root{
            font-size: 100px;
            min-height: 100vh;
            background-color: #e0e0e0;
        }
        .hide{
            display: none;
        }
        .header{
            --bgcolor:#3cb0d0;
            height: .68rem;
            background-color: var(--bgcolor);
            width: 100%;
            display: flex;
            align-items:center;
            justify-content:center;
            --suggestheight:.34rem;
        }
        .header .suggest{
            position: relative;
            height: var(--suggestheight);
            font-size: 14px;
            background-color: #ffffff;
            line-height: var(--suggestheight);
            color: #888;
            font-size: 12px;
            padding-left: .1rem;
        }
        .header .suggest input{
            margin: 0 .1rem 0 .1rem;
            height: .22rem;
            font-size: 14px;
            border: none;
            outline: none;
        }
        .header .exchange{
            color: #fff;
            font-size: 14px;
            margin: 0 .2rem;
        }
        .header .citylist{
            position: absolute;
            top: .34rem;
            left: 0;
            right: 0;
            border: 1px solid var(--bgcolor);
            background-color: #ffffff;
            text-align: center;
            padding-bottom: .05rem;
            z-index: 10;
        }
        .header .citylist>p{
            padding-left: .05rem;
            font-size: 12px;
            line-height: .24rem;
            text-align: left;
        }
        .header .citylist>p.active{
            background-color: var(--bgcolor);
            color: #ffffff;
            cursor: pointer;
        }
        .header .citylist>a{
            margin-right: .05rem;
            padding: .02rem;
            color: #5d9cec;
        }
        .header .citylist>.disabled{
            color: #333;
        }
        .header .citylist>.error{
            color: #ff0000 !important;
        }
        .header .search{
            margin-left: .16rem;
            height: .36rem;
            line-height: .36rem;
            width: 1.12rem;
            background-color: #fc5830;
            color: #fff;
            font-size: 18px;
            outline: 0;
            border: 0;
            cursor: pointer;
            font-family: 'Microsoft YaHei';
        }
        .list .container{
            background-color: #ffffff;
            margin-bottom: .1rem;
        }
        .item{
            display: flex;
            font-size: 12px;
            border-bottom: 1px #e0e0e0 solid;
            height: 1rem;
        }
        .item .icon{
            display: flex;
            align-items:center;
            justify-content:flex-end;
            width: .5rem;
            padding-right: .1rem;
        }
        .item .info{
            flex:1;
            align-items:center;
            justify-content:center;
            display: flex;
        }
        .item .price{
            width: 1rem;
            padding-right: .5rem;
            display: flex;
            align-items:center;
            justify-content:center;
        }
        .item :-webkit-any(.from,.during,.to){
            margin-left: .1rem;
        }
        .item :-webkit-any(.from,.to) .time{
            font-size: 20px;
            font-weight: bolder;
        }
        .item :-webkit-any(.from,.to) .city{
            font-size: 14px;
        }
        .item .during{
            font-size: 12px;
            text-align: center;
        }
        .item .during .usetime{
            color: #888888;
        }
        .item .during .seperate{
            --bcolor:#888;
            line-height: .3;
            border-bottom: 1px solid var(--bcolor);
            position: relative;
        }
        .item .during .seperate:after{
            content: '';
            width: .05rem;
            position: absolute;
            border-bottom: 1px solid var(--bcolor);
            right: 0;
            top: -2px;
            transform:rotate(45deg);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="suggest" data-role="suggest">
            出发<input data-station="from" data-role="input" type="text" name="start" placeholder="请输入出发城市"/>
            <div data-role="citylist" class="citylist hide"></div>
        </div>
        <a href="#" class="exchange" action-type="exchange" tabindex="-1">一换一</a>
        <div class="suggest" data-role="suggest">
            到达<input data-station="to" data-role="input" type="text" name="end" placeholder="请输入到达城市"/>
            <div data-role="citylist" class="citylist hide"></div>
        </div>
        <input type="button" value="搜索" data-role="search" class="search" />
    </div>
    <div class="list" data-role="list">

    </div>
    <script src="./Suggest.js"></script>
    <script>
    {
        const listUrl='';
        function initSuggest(){
            const suggests= [...document.querySelectorAll('[data-role="suggest"]')];
            //出发 到达用一个cache
            const cache= new SuggestCache();
            for(let suggest of suggests){
                new Suggest(suggest,{cache});
            }
        }
        function repeat(data){
            let strArr=[];
            return function(strs,...params){
                for(let i of data){
                    strArr.push(String.raw({raw:strs},...params.map(item=>i[item])));
                }
                return strArr.join('');
            }
        }
        function renderItem(data){
            let str=repeat(data)`
                <div class="item">
                    <div class="icon">${'type'}</div>
                    <div class="info">
                        <div class="from">
                            <p class="time">${'startTime'}</p>
                            <p class="city">${'startCity'}</p>
                        </div>
                        <div class="during">
                            <p class="usetime">${'duration'}</p>
                            <p class="seperate"></p>
                            <p>${'number'}</p>
                        </div>
                        <div class="to">
                            <p class="time">${'arriveTime'}</p>
                            <p class="city">${'arriveCity'}</p>
                        </div>
                    </div>
                    <div class="price">
                        <span>&yen;</span>${'price'}
                    </div>
                </div>`;
            return str;
        }
        function renderList(data){
            const arr=[];
            for(let container of data){
                let item=renderItem(container.items);
                arr.push(`
                    <div class='container'>
                        ${item}
                    </div>`);
            }
            document.querySelector('[data-role="list"]').innerHTML=arr.join('');
        }
        function bindEvents(){
            const suggetInput= [...document.querySelectorAll('[data-role="input"]')];
            const cityList= [...document.querySelectorAll('[data-role="citylist"]')];
            //换
            document.querySelector('[action-type="exchange"]').onclick=function(e){
                e.preventDefault();
                [suggetInput[1].value,suggetInput[0].value]= [...suggetInput.map(item=>item.value)];
            }
            document.querySelector(':root').onclick=function(){
                cityList.forEach(function(item,index){
                    if(!item.classList.contains('hide')){
                        let active=item.querySelector('.active');
                        if(!active.classList.contains('error')){
                            suggetInput[index].value=active.innerHTML;
                            suggetInput[index].parentNode.classList.remove('invaild');
                        }else{
                            suggetInput[index].value='';
                        }
                        item.classList.add('hide');
                    }
                });
            }
            document.querySelector('[data-role="search"]').onclick=function(e){
                const params=[];
                let flag=true;
                suggetInput.forEach(function(item){
                   if(!item.value){
                       item.parentNode.classList.add('invaild');
                       flag=false;
                       return false;
                   }
                   params.push(`${item.getAttribute('name')}=${item.value}`);
                });
                if(flag){
                    fetch(`${listUrl}?${params.join('&')}`)
                        .then(response=>response.json())
                        .then(data=>renderList(data));
                }
            }
        }

        function init(){
            initSuggest();
            bindEvents();

            //test code
            renderList([
                {
                    'items':[{
                        'type':'火车',
                        'startTime':'11:44',
                        'startCity':'北京',
                        'duration':'22时44分',
                        'number':'K44',
                        'arriveTime':'02:23',
                        'arriveCity':'乌鲁木齐',
                        'price':'11.4'
                    },{
                        'type':'飞机',
                        'startTime':'11:44',
                        'startCity':'北京',
                        'duration':'22时44分',
                        'number':'K44',
                        'arriveTime':'02:23',
                        'arriveCity':'乌鲁木齐',
                        'price':'12'
                    },{
                        'type':'轮船',
                        'startTime':'11:44',
                        'startCity':'北京',
                        'duration':'22时44分',
                        'number':'K44',
                        'arriveTime':'02:23',
                        'arriveCity':'乌鲁木齐',
                        'price':'50'
                    }]
                },{
                    'items':[{
                        'type':'火车',
                        'startTime':'11:44',
                        'startCity':'北京',
                        'duration':'22时44分',
                        'number':'K44',
                        'arriveTime':'02:23',
                        'arriveCity':'乌鲁木齐',
                        'price':'11.4'
                    },{
                        'type':'飞机',
                        'startTime':'11:44',
                        'startCity':'北京',
                        'duration':'22时44分',
                        'number':'K44',
                        'arriveTime':'02:23',
                        'arriveCity':'乌鲁木齐',
                        'price':'12'
                    }]
                },{
                    'items':[{
                        'type':'火车',
                        'startTime':'11:44',
                        'startCity':'北京',
                        'duration':'22时44分',
                        'number':'K44',
                        'arriveTime':'02:23',
                        'arriveCity':'乌鲁木齐',
                        'price':'11.4'
                    },{
                        'type':'飞机',
                        'startTime':'11:44',
                        'startCity':'北京',
                        'duration':'22时44分',
                        'number':'K44',
                        'arriveTime':'02:23',
                        'arriveCity':'乌鲁木齐',
                        'price':'12'
                    }]
                }
            ]);
        }
        init();
    }
    </script>
</body>
</html>