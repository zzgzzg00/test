<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<script>
{
    function addData(db){
        const data=[
            {id:4,name:'a4',age:10,sex:1},
            {id:8,name:'b4',age:20,sex:1},
            {id:9,name:'c4',age:30,sex:2}
        ];
        const trans=db.transaction(['testdb'],'readwrite');
        const store=trans.objectStore('testdb');
        data.forEach(function(item){
            const result=store.add(item);
            result.onerror=function(e){
                console.log(e.target.error.message);
            }
        });
    }
    function findByKey(db,index){
        alert(index);
        const trans=db.transaction(['testdb'],'readwrite');
        const store=trans.objectStore('testdb');
        const result=store.get(index);
        alert(2);
        result.onsuccess=function(e){
            alert(JSON.stringify(e));
            const result= e.target.result;
            result.name='xx';
            store.put(result);
            alert(JSON.stringify(result));
        }
    }
    function findByName(db,name){
        const trans=db.transaction(['testdb'],'readwrite');
        const store=trans.objectStore('testdb');
        var range = IDBKeyRange.lowerBound("a",true);
        var index = store.index("name");
        console.log('find by name');
        index.openCursor(range).onsuccess = function (e){
            var cursor= e.target.result;
            if(cursor){
                console.log(cursor.value);
                cursor.continue();
            }
        }
    }
    function deleteByKey(db,index){
        const trans=db.transaction(['testdb'],'readwrite');
        const store=trans.objectStore('testdb');
        const result=store.delete(index);
        result.onsuccess=function(e){
            console.log('delete');
        }
    }
    const request=indexedDB.open('test',3);
    request.onsuccess=function(e){
        var db= e.target.result;
        addData(db);
        findByKey(db,4);
        deleteByKey(db,5);
        findByName(db,'a');
    }
    request.onupgradeneeded=function(e){
        var db= e.target.result;
        if(!db.objectStoreNames.contains('testdb')){
            const objectStore=db.createObjectStore('testdb',{keyPath:'id'});
            objectStore.createIndex('name','name',{unique:true});
            objectStore.createIndex('age','age',{unique:false});
            objectStore.createIndex('sex','sex',{unique:false});
        }
    }
}
</script>
</body>
</html>