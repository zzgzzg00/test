<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=no" />
    <meta name="format-detection"content="telephone=no"/>
    <meta charset="utf-8" />
    <style>
        *{
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        li{
            list-style: none;
        }
        .qn_banner{
            position: relative;
            overflow: hidden;
        }
        .qn_banner li{
            position: absolute;
            top: 0;
            z-index: 1;
            height: 100%;
            -webkit-transform:translateX(100%);
            transition:-webkit-transform .5s ease-out 0s;
            background: #fbfbfb url(//simg2.qunarzz.com/hotel/homesearch/Camal_walk_loading.gif) no-repeat center center;
        }
        .qn_banner .active{
            -webkit-transform:translateX(0);
            z-index: 3;
        }
        .qn_banner .interactive{
            transition:none !important;
        }
        .qn_banner .afteractive{
            z-index: 2;
            -webkit-transform:translateX(-100%);
        }
        .qn_banner li img{
            width: 100%;
        }
    </style>
</head>
<body>
<script>
    function Banner(imgsrcs,container,rato,dur,isInteractive){
        var me=this;
        this.anidur=500;
        this.index=0;
        this.dur=dur;
        this.length=imgsrcs.length;
        this.runHandle=null;
        this.moveTrack=[];
        this.interactiveHandle=null;
        this.lis=imgsrcs.map(function(item,index){
            var li=document.createElement('li'),
                img=document.createElement('img');
            if(index == 0){
                me.setActive(li);
            }
            img.style.visibility='hidden';
            img.onload=me.show.bind(me,img);
            img.src=item.url;
            img.setAttribute('skip',item.skip);
            img.onclick=function(){
//                window.location.href=this.getAttribute('skip');
            }
            if(isInteractive && me.length>2){
                li.addEventListener('touchmove',function(e){
                    me.move(e);
                },false);
                li.style.width=me.getWidth()+'px';
                li.addEventListener('touchend',function(e){
                    if(me.moveTrack.length>0){
                        me.interactiveStart();
                        me.clearTrack();
                    }
                },false);
            }
            img.setAttribute('index',index);
            li.appendChild(img);
            return li;
        });
        var ul=document.createElement('ul');
        ul.className='qn_banner';
        this.width=this.getWidth();
        ul.style.height=this.width*(1/rato)+'px'
        this.lis.forEach(function(item){
            ul.appendChild(item);
        });
        container.appendChild(ul);
        if(me.length==1){
            return;
        }
        this.start(dur);
    }
    Banner.prototype.getWidth=function(){
        return window.innerWidth
                || (document.documentElement && document.documentElement.clientWidth)
                || document.body.clientWidth;
    }
    Banner.prototype.start=function(dur){
        var me=this;
        this.runHandle=window.setTimeout(function(){
            me.run();
        },dur);
    }
    Banner.prototype.stop=function(){
        var me=this;
        if(me.runHandle){
            window.clearTimeout(me.runHandle);
            me.runHandle=null;
        }
    }
    Banner.prototype.show=function(img){
        img.style.visibility='visible';
    }
    Banner.prototype.findNextIndex=function(){
        return (this.index+1)%this.length;
    }
    Banner.prototype.findPreviousIndex=function(){
        var index=this.index-1;
        if(index<0){
            index+=this.length
        }
        return index%this.length;
    }
    Banner.prototype.move=function(e){
        e.preventDefault();
        this.stop();
        this.pushTrack(e);
        this.moveItem();
    }
    Banner.prototype.calcMovePercent=function(){
        var trackLen=this.moveTrack.length,
                offset=this.moveTrack[trackLen-1]-this.moveTrack[0],
                percent=offset/this.width*100;
        return percent;
    }
    Banner.prototype.removeAnimation=function(dom){
        dom.className='interactive';
    }
    Banner.prototype.setTranslate=function(dom,percent){
        dom.style.WebkitTransform='translateX('+percent+'%)';
    }
    Banner.prototype.touchMove=function(dom,percent){
        this.removeAnimation(dom);
        this.setTranslate(dom,percent);
    }
    Banner.prototype.setActive=function(dom){
        dom.className='active';
    }
    Banner.prototype.setAfterActive=function(dom){
        dom.className='afteractive';
    }
    Banner.prototype.setInitAction=function(dom){
        dom.className='';
    }
    Banner.prototype.clearStyle=function(dom){
        dom.style.cssText='';
    }
    Banner.prototype.moveItem=function(){
        var li=this.lis[this.index];
        var percent=this.calcMovePercent();
        this.touchMove(li,percent);
        var previousIndex=this.findPreviousIndex();
        var pli=this.lis[previousIndex];
        this.touchMove(pli,-100+percent);
        var nextIndex=this.findNextIndex();
        var nli=this.lis[nextIndex];
        this.touchMove(nli,100+percent);
    }
    Banner.prototype.run=function(){
        var me=this;
        this.setAfterActive(this.lis[this.index]);
        var afteractive=this.lis[this.index];
        this.index=this.findNextIndex();
        this.setActive(this.lis[this.index]);
        window.setTimeout(function(){
            me.setInitAction(afteractive);
            me.start(me.dur);
        },me.anidur)
    }
    Banner.prototype.interactiveStart=function(){
        var me=this;
        if(this.interactiveHandle){
            window.clearTimeout(me.interactiveHandle);
        }
        var isAfter=this.calcMovePercent()>=0?true:false;
        var li=this.lis[this.index];
        var previousIndex=this.findPreviousIndex();
        var pli=this.lis[previousIndex];
        var nextIndex=this.findNextIndex();
        var nli=this.lis[nextIndex];
        this.clearStyle(li);
        this.clearStyle(nli);
        this.clearStyle(pli);
        if(!isAfter){
            this.setAfterActive(li);
            this.setActive(nli);
            me.setInitAction(pli);
            this.index=this.findNextIndex();
        }else{
            this.setInitAction(li);
            this.setInitAction(nli);
            this.setActive(pli);
            this.index=this.findPreviousIndex();
            window.setTimeout(function(){
                me.setActive(me.lis[me.findPreviousIndex()]);
            },me.anidur);
        }
        this.interactiveHandle=window.setTimeout(function(){
            for(var i=0;i<me.lis.length;i++){
                if(i==me.index){
                    me.setActive(me.lis[i]);
                }else{
                    me.setInitAction(me.lis[i]);
                }
            }
        },me.dur);
        this.start(2*this.dur)
    }
    Banner.prototype.pushTrack=function(e){
        this.moveTrack.push(e.touches[0].clientX);
    }
    Banner.prototype.clearTrack=function(){
        this.moveTrack.length=0;
    }
    var arr=[{
        url:'20161214-3.jpg'
    },{
        url:'20170603-3.jpg'
    },{
        url:'leshi_header.jpg'
    }/*,{
        url:'bupiao.jpg'
    },{
        url:'market711.jpg'
    }*/];
    arr.forEach(function(item){
        item.url= 'https://s.qunarzz.com/open_m_train/active/discovery/'+item.url;
        item.skip='http://www.baidu.com'
    })
    new Banner(arr,document.body,641/341,2000,true);
</script>
</body>
</html>