<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script src="../../common/JSXTransformer.js"></script>
<script src="../../common/react@16.8.5.js"></script>
<script src="../../common/react-dom@16.8.4.js"></script>
<script type="text/jsx">
    React.__spread=Object.assign;
    const {useState,useCallback,useRef}=React;
    function p1(num){
        return new Promise(resolve=>{
            setTimeout(resolve,1000,num);
        })
    }
    function p2(num){
        return new Promise(resolve=>{
            setTimeout(resolve,2000,num);
        })
    }
    const AddOne=({num,callback}={})=>{
        const clickHandle=useCallback(()=>callback(num=>p1(num+1)),[]);
        return(
            <p onClick={clickHandle}>{num}+1</p>
        )
    }
    const MulTwo=({num,callback})=>{
        const clickHandle=useCallback(()=>callback(num=>p2(num*2)),[]);
        return(
            <p onClick={clickHandle}>{num}*2</p>
        )
    }
    const App=props=>{
        let _num=0;
        const [num,setNum]=useState(_num);
        const ref=useRef(Promise.resolve());
        const callback=useCallback((fun=e=>e)=>{
            ref.current=ref.current.then(()=>fun(_num)).then(n=>{_num=n;setNum(_num)});
        },[]);
        const commonProps={num,callback}
        return(
            <div>
                <AddOne {...commonProps} />
                <MulTwo {...commonProps} />
            </div>
        )
    }
    ReactDOM.render(<App />,document.body);
</script>
</body>
</html>