<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        h2{
            text-align: center;
        }
        span{
            color: red;
        }
    </style>
</head>
<body>
<script src="../../common/JSXTransformer.js"></script>
<script src="../../common/react16.8.js"></script>
<script src="../../common/react-dom16.8.js"></script>
<script src="../../common/redux.js"></script>
<script src="../../common/react-redux.js"></script>
<script type="text/jsx">
    const {Fragment}=React;
    const {createStore,combineReducers}=Redux;
    const {Provider,connect}=ReactRedux;
    const initData={
        random:'0.00',
        increment:0
    };
    const randomReducer=(random='0.0',action)=>{
        const {type,newRandom}=action;
        switch(type){
            case 'change':
                return newRandom;
            default:
                return random;
        }
    }
    const incrementReducer=(increment=0,action)=>{
        const {type}=action;
        switch(type){
            case 'add':
                return increment+1;
            default:
                return increment;
        }
    }
    const reducer=combineReducers({
        random:randomReducer,
        increment:incrementReducer
    });
    const randomAction=newRandom=>({type:'change',newRandom});
    const incrementAction=()=>({type:'add'});

    const mapRandomStateToProps=state=>({
        random:state.random
    });
    const mapIncrementStateToProps=state=>({
        increment:state.increment
    })
    const dispatchRandomStateToProps=dispatch=>({
        clickHandle:e=>dispatch(randomAction(`${Math.random().toFixed(2)}`))
    });
    const dispatchIncrementStateToProps=dispatch=>({
        clickHandle:e=>dispatch(incrementAction())
    })

    const Increment=props=>(<p onClick={props.clickHandle}>increment:<span>{props.increment}</span></p>);
    const Random=props=>(<p onClick={props.clickHandle}>random:<span>{props.random}</span></p>);

    const IncrementContainer=connect(mapIncrementStateToProps,dispatchIncrementStateToProps)(Increment);
    const RandomContainer=connect(mapRandomStateToProps,dispatchRandomStateToProps)(Random);

    const store1=createNameStore(reducer,initData,'store1');
    const store2=createNameStore(reducer,initData,'store2');
    const store3=createNameStore(reducer,initData,'store3');

    const createStoreApp=store=>props=>(
        <Provider store={store}>
            <Fragment>
                <h2>{`${formatStr( store.__name )}`}</h2>
                <IncrementContainer />
                <RandomContainer />
            </Fragment>
        </Provider>
    )

    const App1=createStoreApp(store1);
    const App2=createStoreApp(store1);
    const App3=createStoreApp(store3);

    const App=props=>[
        <App1 />,
        <App2 />,
        <App3 />
    ]

    ReactDOM.render(<App />,document.body);

    function formatStr(str,time=4,sep='='){
        const len=str.length;
        return str.padStart(len+time,sep).padEnd(len+2*time,sep);
    }
    function createNameStore(reducer,initData,storeName){
        const store=createStore(reducer,initData);
        store.__name=storeName;
        return store;
    }

</script>
</body>
</html>