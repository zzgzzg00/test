<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script src="../../common/JSXTransformer.js"></script>
<script src="../../common/react16.6.js"></script>
<script src="../../common/react-dom16.6.js"></script>
<script type="text/jsx">
    const {Component}=React;
    function compose(...funcs){
        return function addComponent(Component){
            return funcs.reduceRight((a,b)=>b(a),Component);
        }
    }

    const Show=({context})=>(<div>{context}</div>);
    function withLoading(SmartComponent){
        return class extends Component{
            constructor(props){
                super(props);
                this.state={
                    isLoading:true,
                    context:null
                }
            }
            static getDerivedStateFromProps(nextProps){
                const {context}=nextProps;
                if(!context){
                    return{
                        isLoading:true
                    }
                }
                return {
                    isLoading:false,
                    context
                }
            }
            render(){
                const {isLoading,context}=this.state;
                if(isLoading){
                    return <p>loading...</p>
                }
                return <SmartComponent context={context} />
            }
        }
    }
    function withFetch(SmartComponent){
        return class extends Component{
            constructor(props){
                super(props);
                this.state={
                    isLoading:true,
                    context:null
                }
            }
            componentDidMount(){
                setTimeout(()=>{
                    this.setState({
                        isLoading:false,
                        context:'loaded'
                    })
                },2000);
            }
            render(){
                const {isLoading,context}=this.state;
                return <SmartComponent isLoading={isLoading} context={context}/>
            }
        }
    }
    const ComposeShow=compose(withFetch,withLoading)(Show);
    ReactDOM.render(<ComposeShow />,document.body);
</script>
</body>
</html>