<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script src="../../../common/JSXTransformer.js"></script>
<script src="../../../common/react@16.8.5.js"></script>
<script src="../../../common/react-dom@16.8.4.js"></script>
<script type="text/jsx">
    React.__spread=Object.assign;
    const {useReducer,useCallback,useEffect}=React;
    const reduce=(passengers=[],action)=>{
        const {type,index,name,id,sex,age,editType,value}=action;
        switch(type){
            case 'add':
                passengers.push({
                    name:'',
                    id:'',
                    idType:'1',
                    sex:'',
                    age:''
                });
               return [...passengers];
            case 'del':
                return passengers.filter((item,_index)=>index != _index);
            case 'edit':
                const item=passengers[index];
                item[editType]=value;
                if(editType == 'id' && value == 0){
                    item['sex']=value[0];
                    item['age']=value[1];
                }
                return [...passengers];
            default:
                return passengers;
        }
    }
    const Input=({index,type,change,value})=>{
        return(
            <input onChange={e=>change(index,type,e.target.value)} value={value} />
        )
    }
    const Item=({index,commonProps,change,name,id,sex,age,style,idType,del})=>{
//        useEffect(()=>{
//            if(idType == 0){
//                change(index,'sex',id[0]);
//                change(index,'age',id[1]);
//            }
//            change(index,'id','');
//        },[idType]);
        return(
            <div key={index}>
                <p>{index}-{Math.random().toFixed(2)}</p>
                <div>
                    <span>姓名:</span>
                    <Input {...commonProps} type={'name'} value={name} />
                </div>
                <select value={idType} onChange={e=>change(index,'idType',e.target.value)}>
                    <option value="0">身份证</option>
                    <option value="1">台胞证</option>
                    <option value="2">护照</option>
                </select>
                <div>
                    <span>证件:</span>
                    <Input {...commonProps} type={'id'} value={id} />
                </div>
                <div style={style}>
                    <span>性别:</span>
                    <Input {...commonProps} type={'sex'} value={sex} />
                </div>
                <div style={style}>
                    <span>年龄:</span>
                    <Input {...commonProps} type={'age'} value={age} />
                </div>
                <button onClick={()=>del(index)}>del</button>
            </div>
        )
    }
    const Container=props=>{
        return props.passengers.map((item,index)=>{
            const commonProps={index,change:props.change}
            const style={
                display:item.idType == 0?'none':''
            }
            return(
                <Item
                    key={index}
                    {...item}
                    commonProps={commonProps}
                    index={index}
                    change={props.change}
                    del={props.del}
                    style={style}
                />
            )
        });
    }
    const App=props=>{
        const [passengers,dispatch]=useReducer(reduce,[]);
        console.log(passengers);
        const add=useCallback(()=>dispatch({type:'add'}),[]);
        const del=useCallback(index=>dispatch({type:'del',index}),[]);
        const change=useCallback((index,editType,value)=>dispatch({type:'edit',editType,value,index}))
        return(
            <div>
                <Container passengers={passengers} del={del} change={change}/>
                <button onClick={add}>add</button>
            </div>
        )
    }
    ReactDOM.render(<App />,document.body);
</script>
</body>
</html>