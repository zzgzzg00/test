<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    function createSequnceByWeight(data=[]){
        const map={};
        let start=0,end=0;
        data.forEach((item,index)=>{
            end=start+(item.weight<<0);
            map[`${end}`]=item;
            start=end;
        });
        return map;
    }
    function resetSequnce(map,deletedIndex,deletedWeight){
        const keys=Object.keys(map).map(Number);
        for(let key of keys){
            if(key > deletedIndex){
                const newKey=key-deletedWeight;
                map[newKey]=map[key];
                delete map[key];
            }
        }
        return map;
    }
    function randomItem(map){
        const keys=Object.keys(map).map(Number);
        if(!keys.length){
            return;
        }
        const maxlength=Math.max(...keys);
        const random=(Math.random()*(maxlength+1))<<0;
        let result;
        if(map[random] === undefined){
            for(let key of keys){
                if(key > random){
                    result=key;
                    break;
                }
                result=key;
            }
        }else{
            result=random;
        }
        const item=map[result];
        delete map[result];
        resetSequnce(map,result,item.weight);
        return item;
    }

    const data=[{
        weight:10
    },{
        weight:21
    },{
        weight:12
    },{
        weight:13
    },{
        weight:14
    }];
    const map=createSequnceByWeight(data);
    fetch('../testdata/trainlists.json')
        .then(response=>response.json())
        .then(data=>createSequnceByWeight(data.data.batchData))
        .then(map=>{
            console.log(1,JSON.stringify(map,null,4));
            let item=randomItem(map);
            while (item){
                console.log(item,JSON.stringify(map,null,4));
                item=randomItem(map)
            }
        });
</script>
</body>
</html>