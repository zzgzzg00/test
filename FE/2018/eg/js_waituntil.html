<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
    function waitLimitUntilGetAllResult(time,...promises){
        const timeoutPromise=createTimeoutPromise(time);
        const waitPromise=waitUntilGetAllResult(...promises);
        return Promise.race([timeoutPromise,waitPromise]);
    }

    function waitUntilGetAllResult(...promises){
        const len=promises.length;
        let isOk=true;
        const result=[];
        if(!len){
            return Promise.resolve(result);
        }
        return new Promise((resolve,reject)=>{
            for(let p of promises){
                let promise=Promise.resolve(p);
                promise
                    .then((data)=>{
                        result.push(data);
                        _convertWaitUntilGetAllResultStatus(resolve,reject,result,len,isOk);
                    })
                    .catch((e)=>{
                        isOk=false;
                        result.push(e);
                        _convertWaitUntilGetAllResultStatus(resolve,reject,result,len,isOk);
                    })
            }
        });
    }
    function _convertWaitUntilGetAllResultStatus(resolve,reject,data,len,isOk){
        if(data.length>=len){
            if(isOk){
                resolve(data);
            }else{
                reject(data);
            }
        }
    }

    function createTimeoutPromise(time=0){
        return new Promise((resolve,reject)=>{
            setTimeout(()=>reject('time out'),time*1000);
        })
    }

    function c(sign,time,isOk=true){
        return new Promise((res,rej)=>{
            setTimeout(()=>{
                isOk?res(sign):rej(sign);
            },time*1000);
        })
    }

    waitLimitUntilGetAllResult(2,c('a',2),c('b',1,false),c('c',4),10)
        .then(console.log)
        .catch(console.error);
</script>
</body>
</html>