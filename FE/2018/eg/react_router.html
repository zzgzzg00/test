<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script src="../../common/JSXTransformer.js"></script>
<script src="../../common/react16.3.js"></script>
<script src="../../common/react-dom16.3.js"></script>
<script src="../../common/react-router-dom.js"></script>
<script type="text/jsx">
    /**
     * Consumer需与Provider成层级关系
     * */
    const {Component,Fragment}=React;
    const {HashRouter,Link,Redirect,Route,Switch}=ReactRouterDOM;
    const {Provider,Consumer}=React.createContext();
    React.__spread=Object.assign;
    function wrapConsumer(Component,Consumer){
        return function NewComponent(props){
            return (
                <Consumer>
                    {
                        function addConsumer(data){
                            const allProps=Object.assign({},props,data);
                            return (<Component {...allProps} />)
                        }
                    }
                </Consumer>
            )
        }
    }
    function createTestComponent(key){
        return function Test(props){
            return(
                <Fragment>
                    <p>{key}-{props.data[key]}</p>
                    <span onClick={()=>props.changeState(key)}>change</span>
                </Fragment>
            )
        }
    }
    const [Test1,Test2,Test3]=[createTestComponent('test1'),createTestComponent('test2'),createTestComponent('test3')];
    const [WrapTest1,WrapTest2,WrapTest3]=[wrapConsumer(Test1,Consumer),wrapConsumer(Test2,Consumer),wrapConsumer(Test3,Consumer)];
    const Home=props=>(
        <Fragment>
            <p>home</p>
            <p><Link to={'/t1'}>t1</Link></p>
            <p><Link to={'/t2'}>t2</Link></p>
            <p><Link to={'/t3'}>t3</Link></p>
        </Fragment>
    )
    class Container extends Component{
        constructor(props){
            super(props);
            this.state={
                'test1':'test1',
                'test2':'test2',
                'test3':'test3'
            }
            this.changeState=this.changeState.bind(this);
        }
        changeState(key){
            this.setState({[key]:Math.random()})
        }
        render(){
            return(
                <Provider value={{data:this.state,changeState:this.changeState}}>
                    <WrapTest1 />
                    <Switch>
                        <Route path={'/'} exact component={Home} />
                        <Route path={'/t1'} component={WrapTest1} />
                        <Route path={'/t2'} component={WrapTest2} />
                        <Route path={'/t3'} component={WrapTest3} />
                    </Switch>
                </Provider>
            )
        }
    }
    const App=props=>(
        <HashRouter>
            <Container />
        </HashRouter>
    )
    ReactDOM.render(<App />,document.body);
</script>
</body>
</html>